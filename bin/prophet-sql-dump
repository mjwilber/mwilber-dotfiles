#!/bin/bash

###############################################################################
# Usage
###############################################################################
usage()
{
    echo
	echo "Copy an existing data dump locally"
	echo
	echo "Usage: $self <baseHostName>"
	echo
	echo "   <baseHostName> should be saturn to put a dump from dev-saturndb"
	echo "          $logFile and email the log to IT when complete."
	echo
	exit 1;
}


# /////////////////// Main

if [ $# -lt 1 ]; then
	echo "At least a database host needs to be specified (i.e. neptune -> dev-neptunedb)"
	usage
elif [[ $1 = dev*db ]] || [[ $1 = tgt*db ]] || [[ $1 = stable*db ]]; then
  #debug echo "Using straight up host name"
  dbHost=$1
else
  dbHost=dev-$1db
fi

#destinationDir=$dbHost
destinationFile=${dbHost}_`date +%F`_prophet.dump

if [ -r $destinationFile ]; then
	echo "WARN: $destinationFile already exists. It will be overwritten!"
#	rm -fv $destinationDir/*
#else
#	echo "Creating dir: $destinationDir"
#	mkdir -p $destinationDir;
fi

#pushd $destinationDir > /dev/null
#debug echo PWD=`pwd`

echo "Beginning dump from '$dbHost'"
echo "pg_dump -v -F c -U prophet -h $dbHost prophet > $destinationFile"
pg_dump -v -F c -U prophet -h $dbHost prophet > $destinationFile

echo "COMPLETED: Dump of ${dbHost} to ${destinationFile}"
